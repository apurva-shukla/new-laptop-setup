{
  "version": 3,
  "sources": ["../src/view-project-timers.tsx", "../src/Timers.ts"],
  "sourcesContent": ["import {\n  Action,\n  ActionPanel,\n  Alert,\n  Color,\n  confirmAlert,\n  Icon,\n  Keyboard,\n  launchCommand,\n  LaunchType,\n  List,\n  showToast,\n  Form,\n} from \"@raycast/api\";\n\nimport { useEffect, useState } from \"react\";\nimport {\n  deleteTimer,\n  editTimer,\n  exportTimers,\n  formatDuration,\n  getDuration,\n  getTimers,\n  Timer,\n  TimerList,\n} from \"./Timers\";\n\nfunction EditForm(props: { timer: Timer; onUpdate: (start: Date, end: Date, name: string) => void }) {\n  const [error, setError] = useState(\"\");\n  return (\n    <Form\n      actions={\n        <ActionPanel>\n          <Action.SubmitForm\n            title=\"Submit\"\n            onSubmit={(input) => {\n              const name: string = input.name;\n              const start: Date = input[\"start-date\"];\n              const end: Date = input[\"end-date\"];\n              if (start >= end) {\n                setError(\"End Date must be after Start Date\");\n                return false;\n              }\n              if (end > new Date()) {\n                setError(\"End Date must be a date in the past\");\n                return false;\n              }\n              props.onUpdate(start, end, name);\n            }}\n          />\n        </ActionPanel>\n      }\n    >\n      <Form.TextField title=\"Name\" id=\"name\" defaultValue={props.timer.name || undefined} placeholder=\"Unnamed timer\" />\n      <Form.DatePicker\n        title=\"Start Date\"\n        id={\"start-date\"}\n        defaultValue={new Date(props.timer.start)}\n        // This is important to clear the state of the form. Without it, subsequent submits\n        // will send stale values.\n        onChange={() => setError(\"\")}\n      />\n      <Form.DatePicker\n        error={error}\n        title=\"End Date\"\n        id={\"end-date\"}\n        defaultValue={new Date(props.timer.end!)}\n        // This is important to clear the state of the form. Without it, subsequent submits\n        // will send stale values.\n        onChange={() => setError(\"\")}\n      />\n    </Form>\n  );\n}\n\nexport default function Command() {\n  const [timers, setTimers] = useState<Timer[]>();\n  const [filteredTimers, setFilteredTimers] = useState<Timer[]>([]);\n\n  const [search, setSearch] = useState<string>(\"\");\n\n  const [editingTimer, setEditingTimer] = useState<Timer | undefined>(undefined);\n\n  useEffect(() => {\n    getTimers().then(refresh);\n  }, []);\n\n  useEffect(() => {\n    if (!timers) {\n      return;\n    }\n\n    setFilteredTimers(timers.filter((timer) => timer.name?.toLowerCase().includes(search.toLowerCase())));\n  }, [timers, search]);\n\n  function refresh(list: TimerList) {\n    const sortedTimers = Object.values(list)\n      .sort((a, b) => b.start - a.start)\n      .slice(0, 50);\n    setTimers(sortedTimers);\n    setFilteredTimers(sortedTimers);\n  }\n\n  if (editingTimer) {\n    return (\n      <EditForm\n        timer={editingTimer}\n        onUpdate={async (start, end, name) => {\n          await editTimer({ ...editingTimer, start: start.getTime(), end: end.getTime(), name });\n          getTimers().then(refresh);\n          setEditingTimer(undefined);\n        }}\n      />\n    );\n  }\n\n  return (\n    <List\n      isLoading={timers === undefined}\n      searchText={search}\n      searchBarPlaceholder={\"Search timers...\"}\n      onSearchTextChange={(text) => setSearch(text)}\n    >\n      {filteredTimers.map((timer) => (\n        <List.Item\n          key={timer.id}\n          title={timer.name ?? \"Unnamed timer\"}\n          subtitle={\n            timer.end\n              ? new Date(timer.start).toLocaleString() + \" - \" + new Date(timer.end).toLocaleString()\n              : new Date(timer.start).toLocaleString()\n          }\n          accessories={[\n            {\n              text: (timer.end ? \"\u2705 \" : \"\u23F3 \") + formatDuration(getDuration(timer)),\n            },\n          ]}\n          actions={\n            <ActionPanel>\n              {!timer.end ? (\n                <Action\n                  icon={Icon.Stop}\n                  title={\"Stop Timer\"}\n                  onAction={() => {\n                    launchCommand({\n                      name: \"stop-timer\",\n                      type: LaunchType.UserInitiated,\n                    });\n                  }}\n                />\n              ) : (\n                <Action\n                  icon={Icon.Repeat}\n                  title={\"Start Again\"}\n                  onAction={() => {\n                    launchCommand({\n                      name: \"start-timer\",\n                      type: LaunchType.UserInitiated,\n                      arguments: {\n                        name: timer.name,\n                      },\n                    });\n                  }}\n                />\n              )}\n              <Action.CopyToClipboard\n                icon={Icon.CopyClipboard}\n                title={\"Copy Duration\"}\n                content={formatDuration(getDuration(timer))}\n              />\n              {!!timer.end && (\n                <Action\n                  icon={Icon.EditShape}\n                  title={\"Edit Timer\"}\n                  shortcut={Keyboard.Shortcut.Common.Edit}\n                  onAction={() => setEditingTimer(timer)}\n                />\n              )}\n              <Action\n                icon={Icon.Trash}\n                title={\"Delete Timer\"}\n                shortcut={Keyboard.Shortcut.Common.Remove}\n                onAction={async () => {\n                  if (\n                    await confirmAlert({\n                      title: \"Are you sure you want to delete this timer?\",\n                      message: \"This action cannot be undone.\",\n                      icon: { source: Icon.Trash, tintColor: Color.Red },\n                      primaryAction: {\n                        style: Alert.ActionStyle.Default,\n                        title: \"Delete timer\",\n                      },\n                      rememberUserChoice: true,\n                    })\n                  ) {\n                    deleteTimer(timer.id).then(refresh);\n                    await showToast({\n                      title: \"Timer with duration \" + formatDuration(getDuration(timer)) + \" deleted\",\n                    });\n                  }\n                }}\n                style={Action.Style.Destructive}\n              />\n              <Action\n                icon={Icon.Download}\n                // eslint-disable-next-line @raycast/prefer-title-case\n                title=\"Export Timers as CSV\"\n                shortcut={{ modifiers: [\"cmd\"], key: \"s\" }}\n                onAction={exportTimers}\n              />\n            </ActionPanel>\n          }\n        />\n      ))}\n    </List>\n  );\n}\n", "import {\n  getPreferenceValues,\n  LocalStorage,\n  openExtensionPreferences,\n  showInFinder,\n  showToast,\n  Toast,\n} from \"@raycast/api\";\nimport { writeFile } from \"fs/promises\";\nimport { join } from \"path\";\n\nexport type Timer = {\n  id: string;\n  name: string | null;\n  start: number;\n  end: number | null;\n};\n\nexport type TimerList = {\n  [key: string]: Timer;\n};\n\nexport async function startTimer(name: string | null = null): Promise<Timer> {\n  await stopTimer();\n\n  const timerId = generateTimerId();\n  const timers = await getTimers();\n\n  const timer: Timer = {\n    id: timerId,\n    name: name,\n    start: new Date().getTime(),\n    end: null,\n  };\n\n  timers[timerId] = timer;\n\n  await LocalStorage.setItem(\"projecttimer.timers\", JSON.stringify(timers));\n  await LocalStorage.setItem(\"projecttimer.runningTimer\", timerId);\n\n  return timer;\n}\n\nexport async function stopTimer(): Promise<Timer | null> {\n  const timerId = await runningTimerId();\n\n  if (!timerId) {\n    return null;\n  }\n\n  const timers = await getTimers();\n  if (!timers[timerId]) {\n    return null;\n  }\n\n  timers[timerId].end = new Date().getTime();\n\n  await LocalStorage.setItem(\"projecttimer.timers\", JSON.stringify(timers));\n  await LocalStorage.removeItem(\"projecttimer.runningTimer\");\n\n  return timers[timerId];\n}\n\nexport async function editTimer(timer: Timer): Promise<Timer | null> {\n  // Disallow setting end time before start time.\n  if (timer.end != null && timer.end <= timer.start) {\n    return null;\n  }\n\n  const timers = await getTimers();\n  // Don't allow editing a running timer.\n  const currentTimerId = await runningTimerId();\n  if (!timers[timer.id] || currentTimerId === timer.id) {\n    return null;\n  }\n\n  timers[timer.id].name = timer.name;\n  timers[timer.id].start = timer.start;\n  timers[timer.id].end = timer.end;\n\n  await LocalStorage.setItem(\"projecttimer.timers\", JSON.stringify(timers));\n\n  return timer;\n}\n\nexport async function runningTimerId(): Promise<string | null> {\n  const id = await LocalStorage.getItem<string>(\"projecttimer.runningTimer\");\n  if (!id) {\n    return null;\n  }\n\n  return id;\n}\n\nexport async function getTimers(): Promise<TimerList> {\n  const json = await LocalStorage.getItem<string>(\"projecttimer.timers\");\n  if (!json) {\n    return {};\n  }\n\n  return JSON.parse(json);\n}\n\nexport function getDuration(timer: Timer): number {\n  const end = timer.end || new Date().getTime();\n  return end - timer.start;\n}\n\nexport function formatDuration(duration: number): string {\n  if (!duration) {\n    return \"-\";\n  }\n\n  const seconds = Math.floor(duration / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n\n  return `${hours.toString().padStart(2, \"0\")}:${(minutes % 60).toString().padStart(2, \"0\")}:${(seconds % 60).toString().padStart(2, \"0\")}`;\n}\n\nfunction generateTimerId(): string {\n  return Math.random().toString(36).substring(2);\n}\n\nexport async function deleteTimer(timerId: string): Promise<TimerList> {\n  const timers = await getTimers();\n  delete timers[timerId];\n\n  await LocalStorage.setItem(\"projecttimer.timers\", JSON.stringify(timers));\n  const currentTimerId = await runningTimerId();\n  if (currentTimerId === timerId) {\n    await LocalStorage.removeItem(\"projecttimer.runningTimer\");\n  }\n\n  return timers;\n}\n\nexport async function exportTimers() {\n  const exportDirectory = getPreferenceValues<ExtensionPreferences>().exportDirectory;\n  if (!exportDirectory) {\n    await showToast({\n      title: \"Export directory not set\",\n      message: \"Please set the export directory in the extension preferences\",\n      style: Toast.Style.Failure,\n      primaryAction: {\n        title: \"Open Preferences\",\n        onAction: () => {\n          openExtensionPreferences();\n        },\n      },\n    });\n    return;\n  }\n\n  const toast = await showToast(Toast.Style.Animated, \"Fetching Timers\");\n  const timers = await getTimers();\n  toast.title = \"Exporting CSV\";\n  const csv =\n    \"id,name,start,end,duration,formatted\\n\" +\n    Object.values(timers)\n      .map((timer) => {\n        const duration = getDuration(timer);\n        return [...Object.values(timer), duration, formatDuration(duration)].join();\n      })\n      .join(\"\\n\");\n\n  const file = join(exportDirectory, `projecttimer.runningTimer-${new Date().getTime()}.csv`);\n  try {\n    await writeFile(file, csv, \"utf8\");\n    toast.message = file;\n    toast.style = Toast.Style.Success;\n    toast.title = \"Exported CSV\";\n    toast.primaryAction = {\n      title: \"Show in Finder\",\n      async onAction() {\n        await showInFinder(file);\n      },\n    };\n  } catch (error) {\n    toast.style = Toast.Style.Failure;\n    toast.title = \"Export failed\";\n    toast.message = `${error}`;\n  }\n}\n"],
  "mappings": "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",
  "names": ["view_project_timers_exports", "__export", "Command", "__toCommonJS", "import_api", "import_react", "import_api", "import_promises", "import_path", "editTimer", "timer", "timers", "getTimers", "currentTimerId", "runningTimerId", "id", "json", "getDuration", "formatDuration", "duration", "seconds", "minutes", "deleteTimer", "timerId", "timers", "getTimers", "runningTimerId", "exportTimers", "exportDirectory", "toast", "csv", "timer", "duration", "getDuration", "formatDuration", "file", "error", "import_jsx_runtime", "EditForm", "props", "error", "setError", "input", "name", "start", "end", "Command", "timers", "setTimers", "filteredTimers", "setFilteredTimers", "search", "setSearch", "editingTimer", "setEditingTimer", "getTimers", "refresh", "timer", "list", "sortedTimers", "a", "b", "editTimer", "text", "formatDuration", "getDuration", "deleteTimer", "exportTimers"]
}
