{
  "version": 3,
  "sources": ["../src/start-timer.tsx", "../src/Timers.ts"],
  "sourcesContent": ["import { LaunchProps, showHUD } from \"@raycast/api\";\nimport { startTimer } from \"./Timers\";\n\nexport default async function Command(options: LaunchProps) {\n  let name = options.arguments.name;\n  if (name?.trim().length === 0) {\n    name = \"Unnamed timer\";\n  }\n  const timer = await startTimer(name);\n\n  if (timer === null) {\n    await showHUD(\"Starting timer...\");\n    return;\n  }\n\n  await showHUD(`Started ${timer.name}`);\n}\n", "import {\n  getPreferenceValues,\n  LocalStorage,\n  openExtensionPreferences,\n  showInFinder,\n  showToast,\n  Toast,\n} from \"@raycast/api\";\nimport { writeFile } from \"fs/promises\";\nimport { join } from \"path\";\n\nexport type Timer = {\n  id: string;\n  name: string | null;\n  start: number;\n  end: number | null;\n};\n\nexport type TimerList = {\n  [key: string]: Timer;\n};\n\nexport async function startTimer(name: string | null = null): Promise<Timer> {\n  await stopTimer();\n\n  const timerId = generateTimerId();\n  const timers = await getTimers();\n\n  const timer: Timer = {\n    id: timerId,\n    name: name,\n    start: new Date().getTime(),\n    end: null,\n  };\n\n  timers[timerId] = timer;\n\n  await LocalStorage.setItem(\"projecttimer.timers\", JSON.stringify(timers));\n  await LocalStorage.setItem(\"projecttimer.runningTimer\", timerId);\n\n  return timer;\n}\n\nexport async function stopTimer(): Promise<Timer | null> {\n  const timerId = await runningTimerId();\n\n  if (!timerId) {\n    return null;\n  }\n\n  const timers = await getTimers();\n  if (!timers[timerId]) {\n    return null;\n  }\n\n  timers[timerId].end = new Date().getTime();\n\n  await LocalStorage.setItem(\"projecttimer.timers\", JSON.stringify(timers));\n  await LocalStorage.removeItem(\"projecttimer.runningTimer\");\n\n  return timers[timerId];\n}\n\nexport async function editTimer(timer: Timer): Promise<Timer | null> {\n  // Disallow setting end time before start time.\n  if (timer.end != null && timer.end <= timer.start) {\n    return null;\n  }\n\n  const timers = await getTimers();\n  // Don't allow editing a running timer.\n  const currentTimerId = await runningTimerId();\n  if (!timers[timer.id] || currentTimerId === timer.id) {\n    return null;\n  }\n\n  timers[timer.id].name = timer.name;\n  timers[timer.id].start = timer.start;\n  timers[timer.id].end = timer.end;\n\n  await LocalStorage.setItem(\"projecttimer.timers\", JSON.stringify(timers));\n\n  return timer;\n}\n\nexport async function runningTimerId(): Promise<string | null> {\n  const id = await LocalStorage.getItem<string>(\"projecttimer.runningTimer\");\n  if (!id) {\n    return null;\n  }\n\n  return id;\n}\n\nexport async function getTimers(): Promise<TimerList> {\n  const json = await LocalStorage.getItem<string>(\"projecttimer.timers\");\n  if (!json) {\n    return {};\n  }\n\n  return JSON.parse(json);\n}\n\nexport function getDuration(timer: Timer): number {\n  const end = timer.end || new Date().getTime();\n  return end - timer.start;\n}\n\nexport function formatDuration(duration: number): string {\n  if (!duration) {\n    return \"-\";\n  }\n\n  const seconds = Math.floor(duration / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n\n  return `${hours.toString().padStart(2, \"0\")}:${(minutes % 60).toString().padStart(2, \"0\")}:${(seconds % 60).toString().padStart(2, \"0\")}`;\n}\n\nfunction generateTimerId(): string {\n  return Math.random().toString(36).substring(2);\n}\n\nexport async function deleteTimer(timerId: string): Promise<TimerList> {\n  const timers = await getTimers();\n  delete timers[timerId];\n\n  await LocalStorage.setItem(\"projecttimer.timers\", JSON.stringify(timers));\n  const currentTimerId = await runningTimerId();\n  if (currentTimerId === timerId) {\n    await LocalStorage.removeItem(\"projecttimer.runningTimer\");\n  }\n\n  return timers;\n}\n\nexport async function exportTimers() {\n  const exportDirectory = getPreferenceValues<ExtensionPreferences>().exportDirectory;\n  if (!exportDirectory) {\n    await showToast({\n      title: \"Export directory not set\",\n      message: \"Please set the export directory in the extension preferences\",\n      style: Toast.Style.Failure,\n      primaryAction: {\n        title: \"Open Preferences\",\n        onAction: () => {\n          openExtensionPreferences();\n        },\n      },\n    });\n    return;\n  }\n\n  const toast = await showToast(Toast.Style.Animated, \"Fetching Timers\");\n  const timers = await getTimers();\n  toast.title = \"Exporting CSV\";\n  const csv =\n    \"id,name,start,end,duration,formatted\\n\" +\n    Object.values(timers)\n      .map((timer) => {\n        const duration = getDuration(timer);\n        return [...Object.values(timer), duration, formatDuration(duration)].join();\n      })\n      .join(\"\\n\");\n\n  const file = join(exportDirectory, `projecttimer.runningTimer-${new Date().getTime()}.csv`);\n  try {\n    await writeFile(file, csv, \"utf8\");\n    toast.message = file;\n    toast.style = Toast.Style.Success;\n    toast.title = \"Exported CSV\";\n    toast.primaryAction = {\n      title: \"Show in Finder\",\n      async onAction() {\n        await showInFinder(file);\n      },\n    };\n  } catch (error) {\n    toast.style = Toast.Style.Failure;\n    toast.title = \"Export failed\";\n    toast.message = `${error}`;\n  }\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAqC,wBCArC,IAAAC,EAOO,wBAeP,eAAsBC,EAAWC,EAAsB,KAAsB,CAC3E,MAAMC,EAAU,EAEhB,IAAMC,EAAUC,EAAgB,EAC1BC,EAAS,MAAMC,EAAU,EAEzBC,EAAe,CACnB,GAAIJ,EACJ,KAAMF,EACN,MAAO,IAAI,KAAK,EAAE,QAAQ,EAC1B,IAAK,IACP,EAEA,OAAAI,EAAOF,CAAO,EAAII,EAElB,MAAM,eAAa,QAAQ,sBAAuB,KAAK,UAAUF,CAAM,CAAC,EACxE,MAAM,eAAa,QAAQ,4BAA6BF,CAAO,EAExDI,CACT,CAEA,eAAsBL,GAAmC,CACvD,IAAMC,EAAU,MAAMK,EAAe,EAErC,GAAI,CAACL,EACH,OAAO,KAGT,IAAME,EAAS,MAAMC,EAAU,EAC/B,OAAKD,EAAOF,CAAO,GAInBE,EAAOF,CAAO,EAAE,IAAM,IAAI,KAAK,EAAE,QAAQ,EAEzC,MAAM,eAAa,QAAQ,sBAAuB,KAAK,UAAUE,CAAM,CAAC,EACxE,MAAM,eAAa,WAAW,2BAA2B,EAElDA,EAAOF,CAAO,GARZ,IASX,CAwBA,eAAsBM,GAAyC,CAC7D,IAAMC,EAAK,MAAM,eAAa,QAAgB,2BAA2B,EACzE,OAAKA,GACI,IAIX,CAEA,eAAsBC,GAAgC,CACpD,IAAMC,EAAO,MAAM,eAAa,QAAgB,qBAAqB,EACrE,OAAKA,EAIE,KAAK,MAAMA,CAAI,EAHb,CAAC,CAIZ,CAmBA,SAASC,GAA0B,CACjC,OAAO,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,UAAU,CAAC,CAC/C,CDvHA,eAAOC,EAA+BC,EAAsB,CAC1D,IAAIC,EAAOD,EAAQ,UAAU,KACzBC,GAAM,KAAK,EAAE,SAAW,IAC1BA,EAAO,iBAET,IAAMC,EAAQ,MAAMC,EAAWF,CAAI,EAEnC,GAAIC,IAAU,KAAM,CAClB,QAAM,WAAQ,mBAAmB,EACjC,MACF,CAEA,QAAM,WAAQ,WAAWA,EAAM,IAAI,EAAE,CACvC",
  "names": ["start_timer_exports", "__export", "Command", "__toCommonJS", "import_api", "import_api", "startTimer", "name", "stopTimer", "timerId", "generateTimerId", "timers", "getTimers", "timer", "runningTimerId", "runningTimerId", "id", "getTimers", "json", "generateTimerId", "Command", "options", "name", "timer", "startTimer"]
}
